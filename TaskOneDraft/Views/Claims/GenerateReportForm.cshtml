@{
    ViewData["Title"] = "Generate Report";
}

<style>
    .report-container {
        margin-bottom: 100px;
    }

    .login-title {
        color: black;
        text-shadow: 0 0 2px #00ffcc;
        font-size: 24px;
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        text-align: left;
        color: black;
        font-weight: bold;
        margin-bottom: 5px;
        text-shadow: 0 0 2px #00ffcc;
    }

    .form-control {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 2px solid #00ffcc;
        border-radius: 4px;
        background-color: transparent;
        color: black;
        transition: border 0.3s;
    }

        .form-control:focus {
            border-color: #1affff;
            outline: none;
            box-shadow: 0 0 8px #00ffcc;
        }

    .btn-primary {
        background-color: #00ffcc;
        border: none;
        padding: 10px 20px;
        color: black;
        width: 100%;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px 0;
        transition: all 0.3s ease;
    }

        .btn-primary:hover {
            background-color: blue;
            box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc, 0 0 30px #00ffcc;
        }

        .btn-primary:active {
            transform: translateY(2px);
        }

    .text-danger {
        color: #ff4d4d;
        font-weight: bold;
    }
</style>

<div class="report-container">
    <h2 class="login-title">Generate Claim Report</h2>
    <form asp-action="GenerateReportt" asp-controller="Claims" method="post" id="generateReportForm">
        <input type="hidden" name="lecturerId" value="@ViewBag.LecturerId" id="lecturerId" />

        <div class="form-group">
            <label for="startDate">Start Date</label>
            <input type="date" id="startDate" name="startDate" class="form-control" required />
        </div>

        <div class="form-group">
            <label for="endDate">End Date</label>
            <input type="date" id="endDate" name="endDate" class="form-control" required />
        </div>

        <button type="submit" class="btn-primary" id="generateButton" disabled>Generate Report</button>
    </form>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            $('#startDate, #endDate').on('change', function () {
                validateClaims();
            });

            function validateClaims() {
                const lecturerId = $('#lecturerId').val();
                const startDate = $('#startDate').val();
                const endDate = $('#endDate').val();

                if (lecturerId && startDate && endDate) {
                    $.ajax({
                        url: '@Url.Action("Validateeee", "Claims")',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            lecturerId: lecturerId,
                            startDate: startDate,
                            endDate: endDate
                        }),
                        success: function (response) {
                            if (response.hasClaims) {
                                toastr.success('Claims found for the specified range.', 'Validation Success', {
                                    positionClass: 'toast-top-right',
                                    timeOut: 3000,
                                    closeButton: true,
                                    progressBar: true
                                });
                                $('#generateButton').prop('disabled', false);
                            } else {
                                toastr.error('No claims found for the specified date range.', 'Validation Error', {
                                    positionClass: 'toast-top-right',
                                    timeOut: 3000,
                                    closeButton: true,
                                    progressBar: true,
                                    onHidden: function () {
                                        $('#generateButton').prop('disabled', true);
                                        $('#startDate, #endDate').val('');
                                        $('#generateButton').prop('disabled', false); // Enable button after reset
                                    }
                                });
                                $('#generateButton').prop('disabled', true);
                            }
                        },
                        error: function () {
                            alert('Error validating claims.');
                        }
                    });
                } else {
                    $('#generateButton').prop('disabled', true);
                }
            }

            // Add Toastr notifications for form submission
            $('#generateReportForm').on('submit', function (event) {
                event.preventDefault();

                toastr.clear();

                toastr.info('Generating Report...', 'Processing', {
                    "positionClass": "toast-top-right",
                    "timeOut": "3000",
                    "closeButton": true,
                    "progressBar": true
                });

                setTimeout(function () {
                    $('#generateReportForm')[0].submit(); // Submit the form after toast
                }, 3000);
            });
        });
    </script>
}
